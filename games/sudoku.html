<!DOCTYPE html>
<html lang="en-US">
    <head>
        <!-- DYNAMIC BETWEEN PAGES -->
        <meta property="og:title" content="SUDOKU ;]" id="title" />
        <meta property="og:description" content="A simple game of sudoku" />
        <meta name="description" content="A simple game of sudoku" />

        <!-- STATIC BETWEEN PAGES -->
        <meta property="og:type" content="website" />
        <meta name="twitter:site" content="@VoxelPrismatic">
        <meta name="twitter:creator" content="@VoxelPrismatic">
        <meta name="twitter:card" content="summary">
        <meta name="twitter:image" content="https://voxelprismatic.github.io/prizm.dev/assets/image/webp/favi/priz_blue.webp" />
        <meta property="og:image" content="https://voxelprismatic.github.io/prizm.dev/assets/image/favicon.png" />
        <meta name="theme-color" content="#0088FF">
        <meta property="og:site_name" content="PRIZ ;]">
        <meta property="og:image:type" content="image/png" />
        <meta property="og:image:width" content="256" />
        <meta property="og:image:height" content="256" />
        <meta property="og:url" content="https://voxelprismatic.github.io/prizm.dev/" />
        <title>SUDOKU ;]</title>
        <link rel="icon" type="image/png" href="/prizm.dev/assets/image/favicon.png" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta property="og:url" content="https://voxelprismatic.github.io/prizm.dev/games/sudoku" />
        <meta name="author" content="PRIZ ;]" />
        <style type="text/css">
            * {
                font-family: "Ubuntu Mono";
            } #head {
                top: -100px !important;
            } #keys tr:nth-child(odd) {
                background-color: #233;
            } #keys tr:first-child {
                background-color: #344;
            } #keys td, #keys th {
                margin: 5px;
                padding: 5px;
            } pre#logo {
                width: 100%;
                text-align: center;
                font-weight: bold;
                font-size: 24px;
                color: #0ff;
            } .board {
                margin: auto;
                border-spacing: 0px;
            } .board td {
                border: 2px #122 solid;
                transition: all 0.1s cubic-bezier(0, 0.5, 0, 1);
            } table.block {
                margin: auto;
            } .board > tbody > tr > td {
                height: 128px;
                width: 128px;
            } .board.main > tbody > tr > td {
                background-color: #122 !important;
            } #notes .block td, .block td.filled {
                background-color: #233 !important;
            } .block td {
                height: 32px;
                width: 32px;
                text-align: center;
                color: #fff;
            } #notes .block td {
                font-size: 66% !important;
                line-height: 10px;
            } .board.main td {
                background-color: #233;
                border: 2px #122 solid;
            } .cyan {
                background-color: #0ff1;
                border: 2px solid #0ff !important;
                transition: none !important;
                opacity: 0.25;
            } .black {
                background-color: #000;
                margin: 2px;
                transition: none !important;
            } .seafoam {
                background-color: #0f81;
                border: 2px solid #0f8 !important;
                transition: none !important;
                opacity: 0.25;
            } .noted {
                background-color: #0ff2 !important;
                border: 4px solid #0ff8 !important;
                transition: all 0.1s !important;
                opacity: 1 !important;
                width: 28px !important;
                height: 28px !important;
            } .white {
                background-color: #fff3 !important;
                border: 2px solid #fff !important;
                transition: none !important;
            } .red {
                background-color: #f004 !important;
                border: 4px solid #f00 !important;
                transition: all 0.1s !important;
                opacity: 1 !important;
                width: 28px !important;
                height: 28px !important;
            } .highlighted:not(.white):not(.red):not(.only), .highlighted.semiopac:not(.red):not(.only) {
                background-color: #0ff4 !important;
                border: 4px solid #0ff !important;
                transition: all 0.1s !important;
                opacity: 1 !important;
                width: 28px !important;
                height: 28px !important;
            } .highlighted.only:not(.white):not(.red), .highlighted.only.semiopac:not(.red) {
                background-color: #08f4 !important;
                border: 4px solid #08f !important;
                transition: all 0.1s !important;
                opacity: 1 !important;
                width: 28px !important;
                height: 28px !important;
            } h1, h3, details {
                color: #0ff;
                text-align: center;
            } .mid {
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
            } summary h3 {
                display: inline-block;
            } button {
                background-color: #0ff4;
                border: 2px solid #0ff;
                color: #0ff;
                border-radius: 4px;
                padding: 10px;
                margin: 10px;
                height: 37px;
                width: 37px;
                font-size: 18px;
                font-weight: bold;
                padding-top: 4px;
            } .preset {
                background-color: #011;
                font-weight: bold;
                font-style: italic;
            } .block td:not(.preset) {
                font-weight: bold;
                font-size: x-large;
            } .darker {
                color: #666 !important;
            } button.toggle, button.toggled {
                background-color: #0f84;
                border-color: #0f8;
                color: #0f8;
            }
            #fuckme {
                line-height: 8px;
                font-size: 75%;
                height: 20px;
            } .noted {
                font-size: 60%;
                line-height: 60%;
            } .semiopac {
                opacity: 1;
            } .noopac {
                opacity: 0.25;
            } .white:not(.semiopac) {
                opacity: 1;
                border-width: 6px !important;
                width: 26px !important;
                height: 26px !important;
            } #cover {
                background-color: #233;
                height: 400px;
                width: 400px;
                position: absolute;
                left: 50%;
                z-index: 1000;
                transform: translateX(-50%);
                transition: opacity 0.1s cubic-bezier(0, 0.5, 0, 1);
            } #cover h1 {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) rotate(-14deg);
                font-size: 400%;
                margin-top: 0px;
            } #logo:hover {
                cursor: pointer;
            } button[onclick]:hover {
                cursor: pointer;
            } #undo, #redo {
                width: auto !important;
                opacity: 50%;
            }
        </style>
    </head>
    <body class="bgcolor" style="background-color: #122">
        <pre id="logo" onclick="location='/prizm.dev/map#games'">

___________________
|     |     |     |
|  S  |  U  |  D  |
|_____|_____|_____|
|     |     |     |
|  O  |  K  |  U  |
|_____|_____|_____|
|     |     |     |
|  L  |  O  |  L  |
|_____|_____|_____|

<i>~priz edition~</i>
        </pre>
        <div style="text-align: center">
            <details>
                <summary><h3>Key map</h3></summary>
                <table style="color: #ccc; margin: auto;" id="keys">
                    <tr>
                        <th>Key</th>
                        <th>Action</th>
                    </tr>
                    <tr>
                        <td>&Alpha;</td>
                        <td>Move cursor up</td>
                    </tr>
                    <tr>
                        <td>&lt;</td>
                        <td>Move cursor left</td>
                    </tr>
                    <tr>
                        <td>&gt;</td>
                        <td>Move cursor right</td>
                    </tr>
                    <tr>
                        <td>V</td>
                        <td>Move cursor down</td>
                    </tr>
                    <tr>
                        <td>Enter</td>
                        <td>Write to cell<br><i>*Only works with "Digit first" enabled</i></td>
                    </tr>
                    <tr>
                        <td>1-9</td>
                        <td>Select a number, write to cell if "Cells first" is enabled</td>
                    </tr>
                    <tr>
                        <td>BKSP, DEL, 0</td>
                        <td>Clear cell</td>
                    </tr>
                    <tr>
                        <td>SHIFT, *, .</td>
                        <td>Toggle notes</td>
                    </tr>
                    <tr>
                        <td>CTRL, /</td>
                        <td>Toggle cells first or digit first mode</td>
                    </tr>
                </table>
            </details>
            <details>
                <summary><h3>Settings</h3></summary>
                <table style='color: #ccc; margin: auto;' id="keys">
                    <tr>
                        <th>Option</th>
                        <th>Value</th>
                    </tr>
                    <tr>
                        <td>Level<br><i>*Will reset board</i></td>
                        <td>
                            <select id="level" value="0" onchange="localStorage.setItem('__sudoku__level', this.value); new_board()">
                                <option value="0">Noob</option>
                                <option value="1">Easy</option>
                                <option value="2">Intermediate</option>
                                <option value="3">Hard</option>
                                <option value="4">Pro</option>
                                <option value="5"><b><i>NANI!?!?</b></i></option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Timer</td>
                        <td><input type="checkbox" id="timer" onchange="localStorage.setItem('__sudoku__timer', Number(this.checked))"></input></td>
                    </tr>
                </table>
            </details>
        </div>
        <div>
            <h3>Time: <span id='time'>0:00</span></h3>
            <h1>-- Board --</h1>
            <div id="cover"><h1><i>GENERATING</i></h1></div>
            <table class='board main ed mid' id="notes">
                <tr>
                    <td>
                        <table class="block">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                    <td>
                        <table class="block">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                    <td>
                        <table class="block">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td>
                        <table class="block">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                    <td>
                        <table class="block">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                    <td>
                        <table class="block">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td>
                        <table class="block">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                    <td>
                        <table class="block">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                    <td>
                        <table class="block">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                </tr>
            </table>

            <table class='board ed mid' id="grid">
                <tr>
                    <td>
                        <table class="block" id="grid0">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                    <td>
                        <table class="block" id="grid1">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                    <td>
                        <table class="block" id="grid2">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td>
                        <table class="block" id="grid3">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                    <td>
                        <table class="block" id="grid4">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                    <td>
                        <table class="block" id="grid5">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td>
                        <table class="block" id="grid6">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                    <td>
                        <table class="block" id="grid7">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                    <td>
                        <table class="block" id="grid8">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                </tr>
            </table>

            <table class='board ed' style='position: relative; z-index: 100;' id="highlighting">
                <tr>
                    <td>
                        <table class="block">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                    <td>
                        <table class="block">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                    <td>
                        <table class="block">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td>
                        <table class="block">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                    <td>
                        <table class="block">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                    <td>
                        <table class="block">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td>
                        <table class="block">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                    <td>
                        <table class="block">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
                    <td>
                        <table class="block">
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                            <tr> <td></td> <td></td> <td></td> </tr>
                        </table>
                    </td>
            </table>

            <div style="text-align: center; width: 100%">
                <div style="color:#ccc">Consider supporting me on <a href="/prizm.dev/re/patreon" target="_blank" style="color:#0ff">Patreon</a>!</div>
                <button onclick="write_cell(this)" id="n1">1<sup>0</sup></button><button onclick="write_cell(this)" id="n2">2<sup>0</sup></button><button onclick="write_cell(this)" id="n3">3<sup>0</sup></button><br>
                <button onclick="write_cell(this)" id="n4">4<sup>0</sup></button><button onclick="write_cell(this)" id="n5">5<sup>0</sup></button><button onclick="write_cell(this)" id="n6">6<sup>0</sup></button><br>
                <button onclick="write_cell(this)" id="n7">7<sup>0</sup></button><button onclick="write_cell(this)" id="n8">8<sup>0</sup></button><button onclick="write_cell(this)" id="n9">9<sup>0</sup></button><br>
                <button onclick="clear_cell(this)" id="n0" style="width: auto">Clear</button><br>
                <button onclick="taking_notes(this)" id="notes_toggle" style="width: auto" title="Take notes">123</button><button onclick="cell_first(this)" id="cell_toggle" style="width: auto;" title="Choose a cell, then a number">Cells first</button><br>
                <button id="undo" onclick="undo_move()">Undo</button><button onclick="$('#cover').style.opacity = '1';$('#cover').style.zIndex='1000';window.setTimeout(new_board, 100)" style="width: auto">New board</button><button id="redo" onclick="redo_move()">Redo</button><br>
            </div>

        </div>
        <div id="content">
            <script type="text/javascript">
                function $(q, o = document) { return o.querySelector(q) }
                function $$(q, o = document) { return o.querySelectorAll(q) }
                var noting = false;
                var digit_first = false;
                var undo_stack = [];
                var redo_stack = [];
                window.onresize = () => {
                    h = $("#highlighting").clientHeight;
                    w = $("#highlighting").clientWidth;
                    $("#notes").style.height = h + "px";
                    $("#cover").style.height = h + "px";
                    $("#grid").style.height = h + "px";
                    $("#notes").style.width = w + "px";
                    $("#cover").style.width = w + "px";
                    $("#grid").style.width = w + "px";
                }
                window.onresize();
                function cell_first(elem) {
                    digit_first = !digit_first
                    localStorage.setItem("__sudoku__digits", Number(digit_first))
                    if(digit_first) {
                        elem.innerHTML = "Digit first"
                        elem.title = "Choose a digit, then touch the cells"
                        elem.classList.add("toggled")
                    } else {
                        elem.innerHTML = "Cells first"
                        elem.title = "Choose a cell, then a number"
                        elem.classList.remove("toggled")
                        for(var b of $$("button.toggle"))
                            b.classList.remove("toggle")

                    }
                }

                function taking_notes(elem) {
                    noting = !noting
                    if(noting) {
                        elem.innerHTML = "[n]"
                        elem.title = "Fill tiles"
                        elem.classList.add("toggled")
                    } else {
                        elem.innerHTML = "123"
                        elem.title = "Take notes"
                        elem.classList.remove("toggled")
                    }
                }
                currentval = "0"
                function clear_cell(elem, forced = false) {
                    if(digit_first && !forced) {
                        for(var b of $$("button.toggle"))
                            b.classList.remove("toggle")
                        currentval = elem.id.slice(1);
                        elem.classList.add("toggle")
                        return
                    }
                    if(layered_coord(currentcell, $("#grid")).className.includes("preset"))
                        return
                    if(noting) {
                        cell = layered_coord(currentcell, $("#notes"));
                        cell.innerHTML = "";
                        for(var x = 1; x <= 9; x += 1)
                            cell.classList.remove(x + "")
                    } else {
                        layered_coord(currentcell, $("#grid")).innerHTML = "";
                        layered_coord(currentcell, $("#notes")).classList.remove("darker")
                    }
                    refresh_numbers();
                }
                function push_board() {
                    redo_stack = []
                    undo_stack.push([$("#notes").innerHTML, $("#grid").innerHTML])
                    $("#redo").style.opacity = "50%"
                    $("#undo").style.opacity = "100%"
                }
                function undo_move() {
                    if(!undo_stack.length)
                        return
                    redo_stack.push([$("#notes").innerHTML, $("#grid").innerHTML])
                    var state = undo_stack.pop()
                    $("#notes").innerHTML = state[0]
                    $("#grid").innerHTML = state[1]
                    $("#redo").style.opacity = "100%"
                    if(!undo_stack.length)
                        $("#undo").style.opacity = "50%"
                }
                function redo_move() {
                    if(!redo_stack.length)
                        return
                    undo_stack.push([$("#notes").innerHTML, $("#grid").innerHTML])
                    var state = redo_stack.pop()
                    $("#notes").innerHTML = state[0]
                    $("#grid").innerHTML = state[1]
                    $("#undo").style.opacity = "100%"
                    if(!redo_stack.length)
                        $("#redo").style.opacity = "50%"
                }
                function write_cell(elem, forced = false) {
                    if(digit_first && !forced) {
                        for(var b of $$("button.toggle"))
                            b.classList.remove("toggle")
                        currentval = elem.id.slice(1);
                        elem.classList.add("toggle")
                        highlight_number(currentval)
                        return
                    }
                    for(var c of $$(".red"))
                        c.classList.remove("red");
                    if(layered_coord(currentcell, $("#grid")).className == "preset") {
                        return
                    } else if(noting) {
                        push_board()
                        c = layered_coord(currentcell, $("#notes"))
                        c.classList.toggle(elem.id.slice(1))
                        st = ""
                        for(var x = 1; x <= 9; x += 1) {
                            if(c.className.includes(x + ""))
                                st += x
                            else
                                st += "&nbsp;"
                            if(x == 3 || x == 6)
                                st += "<br>"
                            else
                                st += " "
                        }
                        c.innerHTML = st;
                        refresh_numbers()
                    } else {
                        val = elem.id.slice(1)
                        for(var c of $$(".cyan, .seafoam, .white")) {
                            if(c == currentcell)
                                continue
                            d = layered_coord(c, $("#grid"))
                            if(d.innerHTML == val)
                                c.classList.add("red")
                        }
                        if(!$(".red")) {
                            push_board()
                            layered_coord(currentcell, $("#notes")).classList.add("darker")
                            layered_coord(currentcell, $("#grid")).innerHTML = val
                            for(var c of $$(".cyan, .seafoam, .white")) {
                                d = layered_coord(c, $("#notes"));
                                d.classList.remove(val)
                                st = ""
                                for(var x = 1; x <= 9; x += 1) {
                                    if(d.className.includes(x + ""))
                                        st += x
                                    else
                                        st += "&nbsp;"
                                    if(x == 3 || x == 6)
                                        st += "<br>"
                                    else
                                        st += " "
                                }
                                d.innerHTML = st;
                            }
                        }
                        refresh_numbers();
                    }
                }

                function new_board() {
                    $("#cover").style.zIndex = "1000"
                    $("#cover").style.opacity = "1"
                    $("#undo").style.opacity = "50%"
                    $("#redo").style.opacity = "50%"
                    cell0 = [
                        [0, 0, 0],
                        [0, 0, 0],
                        [0, 0, 0],
                    ]
                    cell1 = [
                        [0, 0, 0],
                        [0, 0, 0],
                        [0, 0, 0],
                    ]
                    cell2 = [
                        [0, 0, 0],
                        [0, 0, 0],
                        [0, 0, 0],
                    ]
                    cell3 = [
                        [0, 0, 0],
                        [0, 0, 0],
                        [0, 0, 0],
                    ]
                    cell4 = [
                        [0, 0, 0],
                        [0, 0, 0],
                        [0, 0, 0],
                    ]
                    cell5 = [
                        [0, 0, 0],
                        [0, 0, 0],
                        [0, 0, 0],
                    ]
                    cell6 = [
                        [0, 0, 0],
                        [0, 0, 0],
                        [0, 0, 0],
                    ]
                    cell7 = [
                        [0, 0, 0],
                        [0, 0, 0],
                        [0, 0, 0],
                    ]
                    cell8 = [
                        [0, 0, 0],
                        [0, 0, 0],
                        [0, 0, 0],
                    ]
                    var und = true
                    while(und) {
                        und = false;
                        und = fill_it(cell0, "#grid0", (x, y, n) => true);
                        if(und) continue;
                        und = fill_it(cell1, "#grid1", (x, y, n) => !cell0[y].includes(n));
                        if(und) continue;
                        und = fill_it(cell2, "#grid2", (x, y, n) => {
                            return !cell0[y].includes(n) && !cell1[y].includes(n)
                        });
                        if(und) continue;
                        und = fill_it(cell3, "#grid3", (x, y, n) => {
                            for(var y = 0; y < 3; y += 1) {
                                if(cell0[y][x] == n)
                                    return false
                            }
                            return true
                        });
                        if(und) continue;
                        und = fill_it(cell4, "#grid4", (x, y, n) => {
                            if(cell3[y].includes(n))
                                return false
                            for(var y = 0; y < 3; y += 1) {
                                if(cell1[y][x] == n)
                                    return false
                            }
                            return true
                        });
                        if(und) continue;
                        und = fill_it(cell5, "#grid5", (x, y, n) => {
                            if(cell3[y].includes(n) || cell4[y].includes(n))
                                return false
                            for(var y = 0; y < 3; y += 1) {
                                if(cell2[y][x] == n)
                                    return false
                            }
                            return true
                        });
                        if(und) continue;
                        und = fill_it(cell6, "#grid6", (x, y, n) => {
                            for(var y = 0; y < 3; y += 1) {
                                if(cell0[y][x] == n || cell3[y][x] == n)
                                    return false
                            }
                            return true
                        });
                        if(und) continue;
                        und = fill_it(cell7, "#grid7", (x, y, n) => {
                            if(cell6[y].includes(n))
                                return false
                            for(var y = 0; y < 3; y += 1) {
                                if(cell1[y][x] == n || cell4[y][x] == n)
                                    return false
                            }
                            return true
                        });
                        if(und) continue;
                        und = fill_it(cell8, "#grid8", (x, y, n) => {
                            if(cell6[y].includes(n) || cell7[y].includes(n))
                                return false
                            for(var y = 0; y < 3; y += 1) {
                                if(cell2[y][x] == n || cell5[y][x] == n)
                                    return false
                            }
                            return true
                        });
                    }
                    levels = {
                        "0": [2, 1],
                        "1": [3, 2],
                        "2": [3, 3],
                        "3": [4, 3],
                        "4": [5, 3],
                        "5": [6, 2]
                    }
                    nS = [0, 9, 9, 9, 9, 9, 9, 9, 9, 9]
                    var start, offset
                    [start, offset] = levels[localStorage.getItem("__sudoku__level") || "0"]
                    for(var c = 0; c < 9; c += 1) {
                        for(var x = 0; x < Math.round(Math.random() * offset) + start; x += 1) {
                            ls = $$("#grid .block")[c].querySelectorAll("td")
                            n = Math.floor(Math.random() * ls.length)
                            while(ls[n].className == "" && nS[ls[n].innerHTML] > 1)
                                n = Math.floor(Math.random() * ls.length)
                            nS[ls[n].innerHTML] -= 1
                            ls[n].className = ""
                            ls[n].innerHTML = ""
                        }
                    }
                    refresh_numbers();
                    for(var n of $$("#notes .block td")) {
                        n.className = "";
                        n.innerHTML = "";
                    }
                    t = 0;
                    highlight_coord(1, 1, 1, 1)
                    window.setTimeout(() => $("#cover").style.opacity = "0", 10);
                    window.setTimeout(() => $("#cover").style.zIndex = 0, 110)
                }

                function fill_it(cell, cell_name, check_fn) {
                    var und = true;
                    choices = [1, 2, 3, 4, 5, 6, 7, 8, 9]
                    for(var y = 0; y < 3; y += 1) {
                        for(var x = 0; x < 3; x += 1) {
                            allowed = []
                            for(var n of choices)
                                if(check_fn(x, y, n))
                                    allowed.push(n)
                            n = allowed[Math.floor(Math.random() * allowed.length)]
                            cell[y][x] = n
                            choices = choices.filter((i) => i != n)
                            c = $(cell_name).rows[y].cells[x]
                            c.innerHTML = n == undefined ? "?" : n
                            c.className = "preset"
                            if(n == undefined)
                                return true
                        }
                    }
                    return false
                }

                donthighlight = false

                function get_coord(cell) {
                    var x = cell.cellIndex;
                    var y = cell.parentElement.rowIndex;
                    var cX = cell.parentElement.parentElement.parentElement.parentElement.cellIndex
                    var cY = cell.parentElement.parentElement.parentElement.parentElement.parentElement.rowIndex
                    return [x, y, cX, cY]
                }

                function layered_coord(cell, target) {
                    var x, y, cX, cY
                    [x, y, cX, cY] = get_coord(cell)
                    return target.rows[cY].cells[cX].children[0].rows[y].cells[x]
                }
                function highlight(cell, color = "cyan") {
                    var x, y, cX, cY
                    s = cell.getBoundingClientRect()
                    sY = s.y
                    sX = s.x
                    sH = s.height
                    if(sX < 0 || sY < 0 || sX + sH > innerWidth || sY + sH > innerHeight) {
                        $("#grid").scrollIntoView();
                    }
                    [x, y, cX, cY] = get_coord(cell)
                    ls = $$("#highlighting > tbody > tr")
                    for(var d of $$(".cyan, .white, .seafoam, .black, .highlighted"))
                        d.className = ""
                    for(var c of ls[cY].cells) {
                        for(var d of c.children[0].rows[y].cells) {
                            d.className = color;
                            dd = layered_coord(d, $("#grid"))
                            if(dd.className == "preset")
                                d.className += " noopac"
                        }
                    }
                    for(var e of ls) {
                        c = e.cells[cX]
                        for(var d of c.children[0].rows) {
                            d.cells[x].className = color;
                            dd = layered_coord(d.cells[x], $("#grid"))
                            if(dd.className == "preset")
                                d.cells[x].className += " noopac"
                        }
                    }
                    for(var d of $$("td", cell.parentElement.parentElement)) {
                        d.className = color
                        dd = layered_coord(d, $("#grid"))
                        if(dd.className == "preset")
                            d.className += " noopac"
                    }
                    for(var d of cell.parentElement.cells) {
                        d.className = "white semiopac"
                        dd = layered_coord(d, $("#grid"))
                        if(dd.className == "preset")
                            d.className += " noopac"
                    }
                    for(var r of cell.parentElement.parentElement.rows) {
                        r.cells[x].className = "white semiopac"
                        dd = layered_coord(r.cells[x], $("#grid"))
                        if(dd.className == "preset")
                            r.cells[x].className += " noopac"
                    }
                    cell.classList.remove("semiopac")
                    currentcell = cell;
                    if(digit_first && color == "seafoam") {
                        if($(".toggle") && $(".toggle").innerHTML == "Clear")
                            clear_cell($(".toggle"), true)
                        else if($(".toggle"))
                            write_cell($("#n" + currentval), true)
                    } else if(color == "seafoam") {
                        donthighlight = true;
                    } if(currentval && digit_first) {
                        highlight_number(currentval)
                    } else if(color == "seafoam") {
                        h = layered_coord(cell, $("#grid")).innerHTML
                        highlight_number(h);
                    }
                }

                function highlight_number(h) {
                    if(!h)
                        return
                    for(var d of $$(".highlighted"))
                        d.className = ""
                    for(var d of $$("#notes .block td, #grid .block td")) {
                        dd = layered_coord(d, $("#highlighting"))
                        if(d.className.includes("darker") || d.className.includes("red")) {
                            continue
                        } else if(d.innerHTML.includes(h)) {
                            dd.classList.add("highlighted")
                            if(d.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id == "notes")
                                dd.classList.add("only")
                        }
                    }
                }


                function highlight_coord(x, y, cX, cY) {
                    highlight($("#highlighting").rows[cY].cells[cX].children[0].rows[y].cells[x]);
                }

                function refresh_numbers() {
                    nums = {
                        "1": 0,
                        "2": 0,
                        "3": 0,
                        "4": 0,
                        "5": 0,
                        "6": 0,
                        "7": 0,
                        "8": 0,
                        "9": 0,
                        "": 0
                    }
                    for(var c of $$("#grid .block td"))
                        nums[c.innerHTML] += 1
                    var complete = 0;
                    for(var x = 1; x <= 9; x += 1) {
                        $(`#n${x} sup`).innerHTML = nums[String(x)];
                        $(`#n${x} sup`).title = `${nums[String(x)]} filled; ${9 - nums[String(x)]} remaining`;
                        if(nums[String(x)] == 9) {
                            complete += 1;
                            $(`#n${x}`).style.opacity = "50%";
                        } else {
                            $(`#n${x}`).style.opacity = "100%";
                        }
                    }
                    if(complete == 9) {
                        alert(`Good game! Completed in ${$("#time").innerHTML}`);
                    }

                    table = {
                        "notes": {},
                        "grid": {},
                    }

                    for(var map of ["notes", "grid"]) {
                        var cY = -1;
                        for(var tR of $("#" + map).rows) {
                            cY += 1
                            var cX = -1;
                            table[map][cY] = {}
                            for(var tC of tR.cells) {
                                cX += 1
                                var y = -1
                                table[map][cY][cX] = {}
                                for(var r of tC.children[0].rows) {
                                    y += 1
                                    var x = -1;
                                    table[map][cY][cX][y] = {}
                                    for(var c of r.cells) {
                                        x += 1;
                                        if(map == "grid") {
                                            table[map][cY][cX][y][x] = c.innerHTML
                                            if(c.className.includes("preset"))
                                                table[map][cY][cX][y][x] += "!"
                                        } else {
                                            table[map][cY][cX][y][x] = ""
                                            for(var n = 1; n <= 9; n += 1)
                                                if(c.className.includes(n + ""))
                                                    table[map][cY][cX][y][x] += n;
                                            if(c.className.includes("darker"))
                                                table[map][cY][cX][y][x] += "!";
                                        }
                                    }
                                }
                            }
                        }
                    }
                    localStorage.setItem("__sudoku__board", JSON.stringify(table))
                }

                highlight_coord(1, 1, 1, 1)
                for(var c of $$("#highlighting .block td")) {
                    c.onmouseover = function() { if(!donthighlight) { highlight(this, "cyan") } }
                    c.onclick = function() { highlight(this, "seafoam"); }
                }
                $("#highlighting").onmouseenter = function() { donthighlight = false }

                if(Number(localStorage.getItem("__sudoku__digits")))
                    cell_first($("#cell_toggle"))
                window.onkeydown = (evt) => {
                    switch(evt.key) {
                        case "1":
                        case "2":
                        case "3":
                        case "4":
                        case "5":
                        case "6":
                        case "7":
                        case "8":
                        case "9":
                            write_cell($("#n" + evt.key))
                            evt.preventDefault();
                            break;
                        case "ArrowLeft":
                            var x, y, cX, xY
                            [x, y, cX, cY] = get_coord(currentcell)
                            if(x == 0) {
                                x = 2
                                if(!cX)
                                    cX = 2
                                else
                                    cX -= 1
                            } else {
                                x -= 1
                            }
                            highlight_coord(x, y, cX, cY)
                            evt.preventDefault();
                            break;
                        case "ArrowRight":
                            var x, y, cX, xY
                            [x, y, cX, cY] = get_coord(currentcell)
                            if(x == 2) {
                                x = 0
                                if(cX == 2)
                                    cX = 0
                                else
                                    cX += 1
                            } else {
                                x += 1
                            }
                            highlight_coord(x, y, cX, cY)
                            evt.preventDefault();
                            break;
                        case "ArrowDown":
                            var x, y, cX, xY
                            [x, y, cX, cY] = get_coord(currentcell)
                            if(y == 2) {
                                y = 0
                                if(cY == 2)
                                    cY = 0
                                else
                                    cY += 1
                            } else {
                                y += 1
                            }
                            highlight_coord(x, y, cX, cY)
                            evt.preventDefault();
                            break;
                        case "ArrowUp":
                            var x, y, cX, xY
                            [x, y, cX, cY] = get_coord(currentcell)
                            if(y == 0) {
                                y = 2
                                if(!cY)
                                    cY = 2
                                else
                                    cY -= 1
                            } else {
                                y -= 1
                            }
                            highlight_coord(x, y, cX, cY)
                            evt.preventDefault();
                            break;
                        case "Enter":
                            currentcell.click();
                            evt.preventDefault();
                            break;
                        case "Control":
                        case "/":
                            $("#cell_toggle").click();
                            evt.preventDefault();
                            break;
                        case "Shift":
                        case "*":
                        case ".":
                            $("#notes_toggle").click();
                            evt.preventDefault();
                            break;
                        case "0":
                        case "Delete":
                        case "Backspace":
                            clear_cell($("#n0"))
                            evt.preventDefault();
                            break;
                        case "z":
                        case "Z":
                            undo_move();
                        case "y":
                        case "Y":
                            redo_mode();
                    }
                }
                window.setInterval(() => {
                    t += 1;
                    localStorage.setItem("__sudoku__time", t)
                    if(!Number(localStorage.getItem("__sudoku__timer"))) {
                        $("#time").innerHTML = "0:00"
                        return;
                    }
                    s = t;
                    m = Math.floor(s / 60);
                    s %= 60;
                    h = Math.floor(m / 60);
                    m %= 60;
                    if(h) {
                        st = `${h}:${(m + "").padStart(2, "0")}:${(s + "").padStart(2, "")}`
                    } else {
                        st = `${m}:${(s + "").padStart(2, "0")}`
                    }
                    $("#time").innerHTML = st;
                }, 1000);
                $("#level").value = localStorage.getItem("__sudoku__level") || "0"
                $("#timer").checked = Number(localStorage.getItem("__sudoku__timer")) || 0
                table = JSON.parse(localStorage.getItem("__sudoku__board"))
                if(table != null) {
                    for(var map of Object.keys(table)) {
                        for(var cY of "012") {
                            for(var cX of "012") {
                                for(var y of "012") {
                                    for(var x of "012") {
                                        d = table[map][cY][cX][y][x]
                                        cls = ""
                                        htm = ""
                                        if(map == "grid") {
                                            htm = d.split("!")[0]
                                            if(d.endsWith("!"))
                                                cls = "preset"
                                        } else {
                                            for(var n = 1; n <= 9; n += 1) {
                                                if(d.includes("" + n)) {
                                                    htm += n
                                                    cls += n + " "
                                                } else {
                                                    htm += "&nbsp;"
                                                }
                                                if(n == 3 || n == 6)
                                                    htm += "<br>"
                                                else
                                                    htm += " "
                                            }
                                            if(d.endsWith("!"))
                                                cls += "darker"
                                        }
                                        e = $("#" + map).rows[cY].cells[cX].children[0].rows[y].cells[x]
                                        e.innerHTML = htm;
                                        e.className = cls;
                                    }
                                }
                            }
                        }
                    }
                } else {
                    new_board();
                }
                refresh_numbers()
                $("#cover").style.opacity = "0"
                window.setTimeout(() => $("#cover").style.zIndex = "0", 100)
                var t = Number(localStorage.getItem("__sudoku__time")) || 0;
            </script>
        </div>

            <link rel="stylesheet" type="text/css" href="/prizm.dev/assets/css/fonts.css">
        </div>
    </body>
</html>
