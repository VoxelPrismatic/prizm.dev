<!DOCTYPE html>
<html lang="en-US">
    <head>
        <!-- DYNAMIC BETWEEN PAGES -->
        <meta property="og:title" content="PACMAN ;]" id="title" />
        <meta property="og:description" content="A simple game of pacman" />
        <meta name="description" content="A simple game of pacman" />

        <!-- STATIC BETWEEN PAGES -->
        <meta property="og:type" content="website" />
        <meta name="twitter:site" content="@VoxelPrismatic">
        <meta name="twitter:creator" content="@VoxelPrismatic">
        <meta name="twitter:card" content="summary">
        <meta name="twitter:image" content="https://voxelprismatic.github.io/prizm.dev/assets/image/webp/favi/priz_blue.webp" />
        <meta property="og:image" content="https://voxelprismatic.github.io/prizm.dev/assets/image/favicon.png" />
        <meta name="theme-color" content="#00FFFF">
        <meta property="og:site_name" content="PRIZ ;]">
        <meta property="og:image:type" content="image/png" />
        <meta property="og:image:width" content="256" />
        <meta property="og:image:height" content="256" />
        <meta property="og:url" content="https://voxelprismatic.github.io/prizm.dev/" />
        <title>PACMAN ;]</title>
        <link rel="icon" type="image/png" href="/prizm.dev/assets/image/favicon.png" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta property="og:url" content="https://voxelprismatic.github.io/prizm.dev/" />
        <meta name="author" content="PRIZ ;]" />
        <style type="text/css">
            * {
                font-family: "Ubuntu Mono";
            } #head {
                top: -100px !important;
            } #keys tr:nth-child(odd) {
                background-color: #233;
            } #keys tr:first-child {
                background-color: #344;
            } #keys td, #keys th {
                margin: 5px;
                padding: 5px;
            } pre#logo {
                width: 100%;
                text-align: center;
                font-weight: bold;
                font-size: 24px;
                color: #0ff;
            } .blinky, .inky, .pinky, .clyde, .pac, .power {
                font-weight: bold;
                transition: all 0.1s 0s ease-in-out;
                position: relative;
                top: 0;
                left: 0;
/*                 right: 0; */
/*                 bottom: 0; */
                text-shadow: 0px 0px 8px;
/*                 animation: glow 5s infinite ease-in-out; */
            } .grid {
                color: #08f;
                text-shadow: 0px 0px 4px;
            } .blinky {
                color: #f00;
            } .inky {
                color: #0ff;
            } .pinky {
                color: #f08;
            } .clyde {
                color: #f80;
            } .pac {
                color: #ff0;
            } .power {
                color: #ff8;
                animation: power-blink 5s infinite ease-in-out;
            } h1, h3, details {
                color: #0ff;
                text-align: center;
            } .mid {
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
            } summary h3 {
                display: inline-block;
            } button {
                background-color: #0ff4;
                border: 2px solid #0ff;
                color: #0ff;
                border-radius: 4px;
                padding: 10px;
                margin: 10px;
                height: 37px;
                width: 37px;
                font-size: 18px;
                font-weight: bold;
                padding-top: 4px;
            } .preset {
                background-color: #011;
                font-weight: bold;
                font-style: italic;
            } .block td:not(.preset) {
                font-weight: bold;
                font-size: x-large;
            } .darker {
                color: #666 !important;
            } button.toggle, button.toggled {
                background-color: #0f84;
                border-color: #0f8;
                color: #0f8;
            }
            #fuckme {
                line-height: 8px;
                font-size: 75%;
                height: 20px;
            } .noted {
                font-size: 60%;
                line-height: 60%;
            } .semiopac {
                opacity: .6;
            } .noopac {
                opacity: 0.25;
            } .white:not(.semiopac) {
                opacity: 1;
                border-width: 4px !important;
                width: 28px !important;
                height: 28px !important;
            } #cover {
                background-color: #233;
                height: 400px;
                width: 400px;
                position: absolute;
                left: 50%;
                z-index: 1000;
                transform: translateX(-50%);
                transition: opacity 0.1s cubic-bezier(0, 0.5, 0, 1);
            } #cover h1 {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) rotate(-14deg);
                font-size: 400%;
                margin-top: 0px;
            } #logo:hover {
                cursor: pointer;
            } button[onclick]:hover {
                cursor: pointer;
            } #undo, #redo {
                width: auto !important;
                opacity: 50%;
            } #board {
                white-space: pre;
                text-align: center;
            } .pac.spooked {
                animation: pac-power 0.5s infinite ease-in-out;
            } .blinky.spooked {
                animation: blinky-spooked 1s infinite ease-in-out;
            } .inky.spooked {
                animation: inky-spooked 1s infinite ease-in-out;
            } .pinky.spooked {
                animation: pinky-spooked 1s infinite ease-in-out;
            } .clyde.spooked {
                animation: clyde-spooked 1s infinite ease-in-out;
            } .blinky.ded {
                animation: blinky-ded 1s infinite ease-in-out;
            } .inky.ded {
                animation: inky-ded 1s infinite ease-in-out;
            } .pinky.ded {
                animation: pinky-ded 1s infinite ease-in-out;
            } .clyde.ded {
                animation: clyde-ded 1s infinite ease-in-out;
            } tr, td {
                padding: 0px;
            } table {
                border-spacing: 0px;
                white-space: pre;
                margin: auto;
                left: 0;
                right: 0;
            } .pac.running-out {
                animation: pac-power 0.1s infinite ease-in-out;
            } .spooked.running-out {
                animation-duration: 0.25s;
            } .darker {
                opacity: 0;
            }
            @keyframes pac-power {
                0% {
                    color: #ff0;
                } 33% {
                    color: #fff;
                } 66% {
                    color: #880;
                } 100% {
                    color: #ff0;
                }
            } @keyframes power-blink {
                0% {
                    color: #ff8;
                } 10% {
                    color: #fff;
                } 20% {
                    color: #cca;
                } 30% {
                    color: #ff8;
                } 100% {
                    color: #ff8;
                }
            } @keyframes blinky-spooked {
                0% {
                    color: #f00;
                } 25% {
                    color: #08f;
                } 60% {
                    color: #00f;
                } 75% {
                    color: #00f;
                } 100% {
                    color: #f00;
                }
            } @keyframes pinky-spooked {
                0% {
                    color: #f08;
                } 25% {
                    color: #08f;
                } 60% {
                    color: #00f;
                } 75% {
                    color: #00f;
                } 100% {
                    color: #f08;
                }
            } @keyframes inky-spooked {
                0% {
                    color: #0ff;
                } 25% {
                    color: #08f;
                } 60% {
                    color: #00f;
                } 75% {
                    color: #00f;
                } 100% {
                    color: #0ff;
                }
            } @keyframes clyde-spooked {
                0% {
                    color: #f80;
                } 25% {
                    color: #08f;
                } 60% {
                    color: #00f;
                } 75% {
                    color: #00f;
                } 100% {
                    color: #f80;
                }
            }  @keyframes blinky-ded {
                0% {
                    color: #f00;
                } 25% {
                    color: #fff;
                } 60% {
                    color: #ccc;
                } 75% {
                    color: #ccc;
                } 100% {
                    color: #f00;
                }
            } @keyframes pinky-ded {
                0% {
                    color: #f08;
                } 25% {
                    color: #fff;
                } 60% {
                    color: #ccc;
                } 75% {
                    color: #ccc;
                } 100% {
                    color: #f08;
                }
            } @keyframes inky-ded {
                0% {
                    color: #0ff;
                } 25% {
                    color: #fff;
                } 60% {
                    color: #ccc;
                } 75% {
                    color: #ccc;
                } 100% {
                    color: #0ff;
                }
            } @keyframes clyde-ded {
                0% {
                    color: #f80;
                } 25% {
                    color: #fff;
                } 60% {
                    color: #ccc;
                } 75% {
                    color: #ccc;
                } 100% {
                    color: #f80;
                }
            } @keyframes glow {
                0% {
                    text-shadow: 0px 0px 8px;
                } 10% {
                    text-shadow: 0px 0px 16px;
                } 30% {
                    text-shadow: 0px 0px 8px;
                } 70% {
                    text-shadow: 0px 0px 8px;
                } 90% {
                    text-shadow: 0px 0px 4px;
                } 100% {
                    text-shadow: 0px 0px 8px;
                }
            }
        </style>
    </head>
    <body class="bgcolor" style="background-color: #122">
        <pre id="logo" onclick="location='/prizm.dev/map#games'">

___________________
|                 |
|                 |
|     ____________|
|     | - - - - - -
|     | P A C M A N
|     |____________
|                 |
|                 |
|_________________|

<i>~priz edition~</i>
        </pre>
        <div style="text-align: center">
            <details>
                <summary><h3>Key map</h3></summary>
                <table style="color: #ccc; margin: auto;" id="keys">
                    <tr>
                        <th>Key</th>
                        <th>Action</th>
                    </tr>
                    <tr>
                        <td>&Alpha;</td>
                        <td>Face up</td>
                    </tr>
                    <tr>
                        <td>&lt;</td>
                        <td>Face left</td>
                    </tr>
                    <tr>
                        <td>&gt;</td>
                        <td>Face right</td>
                    </tr>
                    <tr>
                        <td>V</td>
                        <td>Face down</td>
                    </tr>
                    <tr>
                        <td>SPACE</td>
                        <td>Pause game</td>
                    </tr>
                </table>
            </details>
            <details>
                <summary><h3>Settings</h3></summary>
                <table style='color: #ccc; margin: auto;' id="keys">
                    <tr>
                        <th>Option</th>
                        <th>Value</th>
                    </tr>
                    <tr>
                        <td>Level<br><i>*Will reset board</i></td>
                        <td>
                            <select id="level" value="0" onchange="localStorage.setItem('__sudoku__level', this.value); new_board()">
                                <option value="0">Noob</option>
                                <option value="1">Easy</option>
                                <option value="2">Intermediate</option>
                                <option value="3">Hard</option>
                                <option value="4">Pro</option>
                                <option value="5"><b><i>NANI!?!?</b></i></option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Timer</td>
                        <td><input type="checkbox" id="timer" onchange="localStorage.setItem('__sudoku__timer', Number(this.checked))"></input></td>
                    </tr>
                </table>
            </details>
        </div>
        <div>
            <h3>Time: <span id='time'>0:00</span></h3>
            <h1>-- Board --</h1>
            <table id="sprites-pac" style="position: absolute; z-index: 10;">
                <tr><td><span class="pac">C</span></td></tr>
            </table>
            <table id="sprites-bli" style="position: absolute; z-index: 10;">
                <tr><td></td></tr>
            </table>
            <table id="sprites-ink" style="position: absolute; z-index: 10;">
                <tr><td></td></tr>
            </table>
            <table id="sprites-pin" style="position: absolute; z-index: 10;">
                <tr><td></td></tr>
            </table>
            <table id="sprites-cly" style="position: absolute; z-index: 10;">
                <tr><td></td></tr>
            </table>
            <table id="targets" style="display: none; left: 0; right: 0; position: absolute; z-index: 100;"></table>
            <table id="board"></table>

            <div style="text-align: center;">
                ><button onclick='face_up()' title="Face up">&Lambda;</button> <br>
                <button onclick='face_left()' title="Face left">&lt;</button><button onclick='face_down()' title="Face down">V</button><button onclick='face_right()' title="Face right">&gt;</button> <br>
                <button onclick='pause()' title="Pause game">||</button>
            </div>

        </div>
        <div id="content">
            <script type="text/javascript">
                function $(q, o = document) { return o.querySelector(q) }
                function $$(q, o = document) { return o.querySelectorAll(q) }
                // Generic board set up
                var grid_st = `\
╔═════════════════════════╕ ╒═════════════════════════╗.
║ - - - - - - - - - - - - │ │ - - - - - - - - - - - - ║.
║ - ┌─────┐ - ┌───────┐ - │ │ - ┌───────┐ - ┌─────┐ - ║.
║ O │     │ - │       │ - │ │ - │       │ - │     │ O ║.
║ - └─────┘ - └───────┘ - └─┘ - └───────┘ - └─────┘ - ║.
║ - - - - - - - - - - - - - - - - - - - - - - - - - - ║.
║ - ┌─────┐ - ┌─┐ - ┌─────────────┐ - ┌─┐ - ┌─────┐ - ║.
║ - └─────┘ - │ │ - └─────┐ ┌─────┘ - │ │ - └─────┘ - ║.
║ - - - - - - │ │ - - - - │ │ - - - - │ │ - - - - - - ║.
╚═════════╗ - │ └─────┐   │ │   ┌─────┘ │ - ╔═════════╝.
          ║ - │ ┌─────┘   └─┘   └─────┐ │ - ║          .
          ║ - │ │                     │ │ - ║          .
          ║ - │ │   ╔════─────════╗   │ │ - ║          .
══════════╝ - └─┘   ║             ║   └─┘ - ╚══════════.
            -       ║             ║       -            .
══════════╗ - ┌─┐   ║             ║   ┌─┐ - ╔══════════.
          ║ - │ │   ╚═════════════╝   │ │ - ║          .
          ║ - │ │                     │ │ - ║          .
          ║ - │ │   ┌─────────────┐   │ │ - ║          .
╔═════════╝ - └─┘   └─────┐ ┌─────┘   └─┘ - ╚═════════╗.
║ - - - - - - - - - - - - │ │ - - - - - - - - - - - - ║.
║ - ┌─────┐ - ┌───────┐ - │ │ - ┌───────┐ - ┌─────┐ - ║.
║ - └───┐ │ - └───────┘ - └─┘ - └───────┘ - │ ┌───┘ - ║.
║ O - - │ │ - - - - - - -     - - - - - - - │ │ - - O ║.
╙───┐ - │ │ - ┌─┐ - ┌─────────────┐ - ┌─┐ - │ │ - ┌───╜.
╓───┘ - └─┘ - │ │ - └─────┐ ┌─────┘ - │ │ - └─┘ - └───╖.
║ - - - - - - │ │ - - - - │ │ - - - - │ │ - - - - - - ║.
║ - ┌─────────┘ └─────┐ - │ │ - ┌─────┘ └─────────┐ - ║.
║ - └─────────────────┘ - └─┘ - └─────────────────┘ - ║.
║ - - - - - - - - - - - - - - - - - - - - - - - - - - ║.
╚═════════════════════════════════════════════════════╝`
                var grid = []
                function gen_grid() {
                    console.info("Generating Grid")
                    // Set up the grid
                    for(var s of grid_st.split(".\n")) {
                        grid.push(s.split(''))
                    }
                    var html = ("<tr>" + "<td> </td>".repeat(grid[0].length) + "</tr>").repeat(grid.length)
                    var tables = [
                        "#board",
                        "#targets",
                        "#sprites-pac",
                        "#sprites-bli",
                        "#sprites-pin",
                        "#sprites-ink",
                        "#sprites-cly",
                    ]
                    for(var table of tables)
                        $(table).innerHTML = html;
                    $("#sprites-pac td").innerHTML = `<span class="pac">C</span>`
                    $("#sprites-bli td").innerHTML = `<span class="blinky">M</span>`
                    $("#sprites-ink td").innerHTML = `<span class="inky">M</span>`
                    $("#sprites-pin td").innerHTML = `<span class="pinky">M</span>`
                    $("#sprites-cly td").innerHTML = `<span class="clyde">M</span>`
                }

                // Static
                PACMAN = 0;
                BLINKY = 1;
                INKY = 2;
                PINKY = 3;
                CLYDE = 4;

                // Position variables
                var blinky_y = 11;
                var blinky_x = 26;
                var inky_y = 14;
                var inky_x = 22;
                var pinky_y = 14;
                var pinky_x = 26;
                var clyde_y = 14;
                var clyde_x = 30;
                var pac_y = 23;
                var pac_x = 26;
                var home_x = 26;
                var home_y = 14;
                var exit_x = 26;
                var exit_y = 11;

                // Targets
                var blinky_tX = 0;
                var blinky_tY = 0;
                var pinky_tX = 0;
                var pinky_tY = 0;
                var inky_tX = 0;
                var inky_tY = 0;
                var clyde_tX = 0;
                var clyde_tY = 0;

                // Facing
                var pac_face = [-2, 0];
                var blinky_face = [0, 1];
                var pinky_face = [0, 1];
                var inky_face = [0, 1];
                var clyde_face = [0, 1];

                // Other states
                var char = 0;
                var powered = false;
                var blinky_alive = true;
                var pinky_alive = true;
                var inky_alive = true;
                var clyde_alive = true;
                var running_out = false;
                var scatter = false;
                var font_h = $("#sprites-pac tr").getClientRects()[0].height;
                var font_w = $("#sprites-pac").clientWidth;
                var clyde_scatter = false;
                var last_grid = grid.toString();

                function draw_grid() {
                    var tab = $("#board")
                    if(last_grid != grid.toString()) {
                        for(var y = 0; y < grid.length; y += 1) {
                            var r = tab.rows[y];
                            var grid_y = grid[y]
                            for(var x = 0; x < grid_y.length; x += 1) {
                                var c = grid_y[x];
                                var s = r.cells[x];
                                if(c == s.textContent)
                                    continue
                                switch(c) {
                                    case "-":
                                    case " ":
                                        s.innerHTML = `<span style="color: #fff">${c}</span>`;
                                        break;
                                    case "O":
                                        s.innerHTML = `<span class="power">${c}</span>`;
                                        break;
                                    default:
                                        s.innerHTML = `<span class="grid">${c}</span>`;
                                }
                            }
                        }
                    }
                    for(var thing of $$(".darker"))
                        thing.classList.remove("darker")
                    tab.rows[blinky_y].cells[blinky_x].classList.add("darker")
                    tab.rows[inky_y].cells[inky_x].classList.add("darker")
                    tab.rows[pinky_y].cells[pinky_x].classList.add("darker")
                    tab.rows[clyde_y].cells[clyde_x].classList.add("darker")
                    var s = powered ? ' spooked' : ''
                    var r = running_out ? ' running-out' : ''
                    var sprite = $("#sprites-bli span")
                    sprite.className = `blinky${blinky_alive ? s + r : ' ded'}`;
                    sprite.innerHTML = blinky_alive ? "M" : "~"

                    sprite = $("#sprites-pin td")
                    sprite.className = `pinky${pinky_alive ? s + r : ' ded'}`;
                    sprite.innerHTML = pinky_alive ? "M" : "~"

                    sprite = $("#sprites-ink td")
                    sprite.className = `inky${inky_alive ? s + r : ' ded'}`;
                    sprite.innerHTML = inky_alive ? "M" : "~"

                    sprite = $("#sprites-cly td")
                    sprite.className = `clyde${clyde_alive ? s + r : ' ded'}`;
                    sprite.innerHTML = clyde_alive ? "M" : "~"

                    sprite = $("#sprites-pac span")
                    sprite.className = `pac${s + r}`
                    sprite.innerHTML = (pac_y + pac_x/2) % 2 ? 'c' : 'C'

                    tab = $("#targets")
                    tab.rows[clyde_tY].cells[clyde_tX].innerHTML = `<span class="target" style="color: #f80">X</span>`
                    tab.rows[blinky_tY].cells[blinky_tX].innerHTML = `<span class="target" style="color: #f00">X</span>`
                    tab.rows[inky_tY].cells[inky_tX].innerHTML = `<span class="target" style="color: #0ff">X</span>`
                    tab.rows[pinky_tY].cells[pinky_tX].innerHTML = `<span class="target" style="color: #f08">X</span>`
                    reposition();
                }
                gen_grid();
                draw_grid();

                function reposition() {
                    $(".pac").style.top = font_h * pac_y + "px";
                    $(".pac").style.left = font_w * pac_x + "px";

                    $(".blinky").style.top = font_h * blinky_y + "px";
                    $(".blinky").style.left = font_w * blinky_x + "px";

                    $(".pinky").style.top = font_h * pinky_y + "px";
                    $(".pinky").style.left = font_w * pinky_x + "px";

                    $(".inky").style.top = font_h * inky_y + "px";
                    $(".inky").style.left = font_w * inky_x + "px";

                    $(".clyde").style.top = font_h * clyde_y + "px";
                    $(".clyde").style.left = font_w * clyde_x + "px";

                }

                function move_pac(dX, dY, evt) {
                    // Get X/Y of a sprite
                    var vX, vY;
                    var base_allowed = false;
                    var tE = null;
                    switch(char) {
                        case PACMAN:
                            [vX, vY] = [pac_x, pac_y];
                            break;
                        case BLINKY:
                            [vX, vY] = [blinky_x, blinky_y];
                            base_allowed = !blinky_alive;
                            break;
                        case INKY:
                            [vX, vY] = [inky_x, inky_y];
                            base_allowed = !inky_alive;
                            break;
                        case PINKY:
                            [vX, vY] = [pinky_x, pinky_y];
                            base_allowed = !pinky_alive;
                            break;
                        case CLYDE:
                            [vX, vY] = [clyde_x, clyde_y];
                            base_allowed = !clyde_alive;
                            break;
                    }
                    console.log(vX, vY, '[', dX, dY, ']')
                    if(vX == 54 && dX == 2)
                        vX = -2
                    else if(vX == 0 && dX == -2)
                        vX = 56
                    var c = grid[vY + dY][vX + dX]
                    base_allowed |= in_base()
                    base_allowed &= (((vY == 11 && dY == 1) || (vY == 13 && dY == -1)) && vX <= 29 && vX >= 25)
                    console.log(base_allowed)
                    if(" -O".includes(c) || base_allowed) {
                        vX += dX;
                        vY += dY;
                        if(char == 0) { // Is the selected sprite pacman?
                            if(c == "O") { // Set the powerup
                                powered = true;
                                running_out = false;
                                window.setTimeout(() => {
                                    running_out = true;
                                    console.log("Running out!")
                                    draw_grid();
                                    window.setTimeout(() => {
                                        powered = false;
                                        console.log("End")
                                        running_out = false;
                                        draw_grid();
                                    }, 5000);
                                }, 15000);
                            }
                            grid[vY][vX] = " "; // Clear the current space
                            last_face = [dX, dY];
                        }
                    }
                    switch(char) { // Set X/Y vars
                        case PACMAN:
                            [pac_x, pac_y] = [vX, vY];
                            pac_face = [dX, dY];
                            break;
                        case BLINKY:
                            [blinky_x, blinky_y] = [vX, vY];
                            blinky_face = [dX, dY];
                            break;
                        case INKY:
                            [inky_x, inky_y] = [vX, vY];
                            inky_face = [dX, dY];
                            break;
                        case PINKY:
                            [pinky_x, pinky_y] = [vX, vY];
                            pinky_face = [dX, dY];
                            break;
                        case CLYDE:
                            [clyde_x, clyde_y] = [vX, vY];
                            clyde_face = [dX, dY];
                            break;
                    }
                    if(powered) { // Kill a ghost
                        var pf = pac_face.toString()
                        if(pinky_x == pac_x && pinky_y == pac_y && blinky_face.toString() != pf)
                            pinky_alive = false;
                        if(inky_x == pac_x && inky_y == pac_y && inky_face.toString() != pf)
                            inky_alive = false;
                        if(clyde_x == pac_x && clyde_y == pac_y && pinky_face.toString() != pf)
                            clyde_alive = false;
                        if(blinky_x == pac_x && blinky_y == pac_y && clyde_face.toString() != pf)
                            blinky_alive = false;
                    }
                    if(evt)
                        evt.preventDefault();
                    reposition();
                }

                function in_base() {
                    var cX, cY;
                    switch(char) {
                        case PACMAN:
                            [cX, cY] = [pac_x, pac_y];
                            break;
                        case BLINKY:
                            [cX, cY] = [blinky_x, blinky_y];
                            break;
                        case INKY:
                            [cX, cY] = [inky_x, inky_y];
                            break;
                        case PINKY:
                            [cX, cY] = [pinky_x, pinky_y];
                            break;
                        case CLYDE:
                            [cX, cY] = [clyde_x, clyde_y];
                            break;
                    }
                    return cX <= 32 && cY >= 13 && cX >= 22 && cY <= 15;
                }

                function get_distance(cX, cY, tX, tY, face, base_allowed, dX, dY) {
                    if(face[1] == -1 && dY == 1)
                        return 20000;
                    else if(face[1] == 1 && dY == -1)
                        return 20000;
                    else if(face[0] == 2 && dX == -2)
                        return 20000;
                    else if(face[0] == -2 && dX == 2)
                        return 20000;
                    else if(!base_allowed && dY == -1 && (cY == 23 || cY == 11) && (cX == 24 || cX == 30))
                        return 30000;
                    if(cX == 54 && dX == 2)
                        cX = -2
                    else if(cX == 0 && dX == -2)
                        cX = 56
                    base_allowed &= (((cY == 11 && dY == 1) || (cY == 13 && dY == -1)) && cX <= 29 && cX >= 25)
                    console.log(base_allowed)
                    if(" -O".includes(grid[cY + dY][cX + dX]) || base_allowed)
                        return Math.round(
                            Math.sqrt(Math.abs(cX - tX + dX)/2) ** 2 +
                            Math.sqrt(Math.abs(cY - tY + dY)) ** 2
                        )
                    return 10000;
                }

                function fix_target(tX, tY) {
                    if(tY > 30)
                        tY -= 30;
                    else if(tY < 0)
                        tY += 30;
                    if(tX > 54)
                        tX -= 54;
                    else if(tX < 0)
                        tX += 54;
                    return [tX, tY];
                }

                function do_move() {
                    var cX, cY;
                    var tX, tY;
                    var face = [0, 0];
                    var alive = true;
                    switch(char) {
                        case PACMAN:
                            [cX, cY] = [pac_x, pac_y];
                            [tX, tY] = [pac_x, pac_y];
                            face = pac_face;
                            break;
                        case BLINKY:
                            [cX, cY] = [blinky_x, blinky_y];
                            [tX, tY] = [blinky_tX, blinky_tY];
                            face = blinky_face;
                            alive = blinky_alive;
                            break;
                        case INKY:
                            [cX, cY] = [inky_x, inky_y];
                            [tX, tY] = [inky_tX, inky_tY];
                            face = inky_face;
                            alive = inky_alive;
                            break;
                        case PINKY:
                            [cX, cY] = [pinky_x, pinky_y];
                            [tX, tY] = [pinky_tX, pinky_tY];
                            face = pinky_face;
                            alive = pinky_alive;
                            break;
                        case CLYDE:
                            [cX, cY] = [clyde_x, clyde_y];
                            [tX, tY] = [clyde_tX, clyde_tY];
                            face = clyde_face;
                            alive = clyde_alive;
                            break;
                    }
                    var args = [cX, cY, tX, tY, face, !alive || in_base()]
                    var right_dist = get_distance(...args, 2, 0);
                    var left_dist = get_distance(...args, -2, 0);
                    var down_dist = get_distance(...args, 0, 1);
                    var up_dist = get_distance(...args, 0, -1);
                    console.log("Up:", up_dist);
                    console.log("Left:", left_dist);
                    console.log("Down:", down_dist);
                    console.log("Right:", right_dist);
                    var min_dist = Math.min(right_dist, left_dist, up_dist, down_dist)
                    if(powered) {
                        var ls = [right_dist, left_dist, up_dist, down_dist];
                        min_dist = ls[Math.floor(Math.random() * 4)]
                        while(min_dist >= 10000)
                            min_dist = ls[Math.floor(Math.random() * 4)]
                    }
                    switch(min_dist) {
                        case up_dist:
                            move_pac(0, -1);
                            break;
                        case left_dist:
                            move_pac(-2, 0);
                            break;
                        case down_dist:
                            move_pac(0, 1);
                            break;
                        case right_dist:
                            move_pac(2, 0);
                            break;
                    }
                }

                function blinky_target() {
                    char = BLINKY;
                    console.group("Blinky");
                    if(blinky_x == home_x && blinky_y == home_y)
                        blinky_alive = true
                    if(!blinky_alive) {
                        blinky_tX = home_x;
                        blinky_tY = home_y;
                    } else if(in_base()) {
                        blinky_tX = exit_x;
                        blinky_tY = exit_y;
                    } else if(scatter) {
                        blinky_tX = 53;
                        blinky_tY = 0;
                    } else {
                        blinky_tX = pac_x;
                        blinky_tY = pac_y;
                    }
                    console.groupEnd("Blinky");
                    do_move();
                }

                function pinky_target() {
                    char = PINKY;
                    console.group("Pinky");
                    if(pinky_x == home_x && pinky_y == home_y)
                        pinky_alive = true
                    if(!pinky_alive) {
                        pinky_tX = home_x;
                        pinky_tY = home_y;
                    } else if(in_base()) {
                        pinky_tX = exit_x;
                        pinky_tY = exit_y;
                    } else if(scatter) {
                        pinky_tX = 53;
                        pinky_tY = 30;
                    } else {
                        switch(pac_face[1] || pac_face[0]) {
                            case 1:
                                pinky_tX = pac_x;
                                pinky_tY = pac_y + 4;
                                break;
                            case -1:
                                pinky_tX = pac_x - 8;
                                pinky_tY = pac_y - 4;
                                break;
                            case 2:
                                pinky_tY = pac_y;
                                pinky_tX = pac_x + 8;
                                break;
                            case -2:
                                pinky_tY = pac_y;
                                pinky_tX = pac_x - 8;
                                break;
                        }
                        [pinky_tX, pinky_tY] = fix_target(pinky_tX, pinky_tY)
                    }
                    console.groupEnd("Pinky");
                    do_move();
                }

                function inky_target() {
                    char = INKY;
                    console.group("Inky");
                    if(inky_x == home_x && inky_y == home_y)
                        inky_alive = true
                    if(!inky_alive) {
                        inky_tX = home_x;
                        inky_tY = home_y;
                    } else if(in_base()) {
                        inky_tX = exit_x;
                        inky_tY = exit_y;
                    } else if(scatter) {
                        inky_tX = 0;
                        inky_tY = 0;
                    } else {
                        if(blinky_x > pac_x)
                            inky_tX = pac_x + (pac_x - blinky_x);
                        else
                            inky_tX = pac_x - (blinky_x - pac_x);
                        if(blinky_y > pac_y)
                            inky_tY = pac_y + (pac_y - blinky_y);
                        else
                            inky_tY = pac_y - (blinky_y - pac_y);
                        [inky_tX, inky_tY] = fix_target(inky_tX, inky_tY)
                    }
                    console.groupEnd("Inky");
                    do_move();
                }

                function clyde_target() {
                    char = CLYDE;
                    console.group("Clyde");
                    if(clyde_x == home_x && clyde_y == home_y)
                        clyde_alive = true
                    if(clyde_x == 2 && clyde_y == 29)
                        clyde_scatter = false
                    if(!clyde_alive) {
                        clyde_tX = home_x;
                        clyde_tY = home_y;
                    } else if(in_base()) {
                        clyde_tX = exit_x;
                        clyde_tY = exit_y;
                    } else if(scatter || clyde_scatter) {
                        clyde_tX = 0;
                        clyde_tY = 30;
                    } else {
                        clyde_tX = pac_x;
                        clyde_tY = pac_y;
                        if(Math.round(Math.sqrt(Math.abs(clyde_x - pac_x)/2) ** 2 +
                            Math.sqrt(Math.abs(clyde_y - pac_y)) ** 2) <= 8)
                            clyde_scatter = true
                    }
                    console.groupEnd("Clyde");
                    do_move();
                }

                function target() {
                    console.groupCollapsed("Move");
                    var temp_char = Number(char);
                    blinky_target();
                    pinky_target();
                    inky_target();
                    clyde_target();
                    window.setTimeout(draw_grid, 100)
                    char = temp_char;
                    console.groupEnd("Move");
                }

                window.onkeydown = (evt) => {
                    switch(evt.key) {
                        case "ArrowDown":
                            move_pac(0, 1, evt);
                            target();
                            break;
                        case "ArrowLeft":
                            move_pac(-2, 0, evt);
                            target();
                            break;
                        case "ArrowRight":
                            move_pac(2, 0, evt);
                            target();
                            break;
                        case "ArrowUp":
                            move_pac(0, -1, evt);
                            target();
                            break;
                        case "Alt":
                            char = char + 1 == 5 ? 0 : char + 1;
                            break;
                        default:
                            console.log(evt.key);
                    }
                }

                function show_targets() {
                    $("#targets").style.display = "";
                }
                console.warn("Type `show_targets()' to show each ghost's target")
            </script>
        </div>

            <link rel="stylesheet" type="text/css" href="/prizm.dev/assets/css/fonts.css">
        </div>
    </body>
</html>
